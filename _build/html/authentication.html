
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Authentication &#8212; HeLx 1.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="authentication">
<h1>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h1>
<p>Authentication is concerned with verifying the identity of a principal and is distinct from determining what actions the principal is entitled to take in the system. We use the OpenID Connect (OIDC) protocol to federate user identities from an OIDC identity provider (IdP) like Google or GitHub. The OIDC protocol is integrated into the system via open source connectors for the Django environment. This approach entails configuring the application within the platform of each IdP to permit and execute the OIDC handshake.</p>
<div class="section" id="authorization">
<h2>Authorization<a class="headerlink" href="#authorization" title="Permalink to this headline">¶</a></h2>
<p>Authentication is provided via an OpenID Connect (OIDC) Identity Provider (IdP) such as GitHub or Google as well as a SAML2 IdP. A SAML2 IdP can be configured on a per customer basis using django-saml2-auth module. After a principal is authenticated, AppStore uses a request filter to determine if it is whitelisted. A django middleware intercepts the request and checks the authenticated user’s email against an authorized whitelist to grant user access to apps. Certain data such as credentials for social authentication accounts must not be packaged with source code. Therefore this data must be dynamically injected during image deployment using Kubernetes secrets. AppStore offers a command line interface (CLI) consisting of uniform commands for providing default values for secrets for local deployment and a way to insert them for production deployment. It also provides interfaces for creating system super users, data migration, starting the application, and packaging executables, among other tasks.</p>
<div class="section" id="secrets">
<h3>Secrets<a class="headerlink" href="#secrets" title="Permalink to this headline">¶</a></h3>
<p>Data that serves, for example, as a credential for an authentication, must be secret. Since it may not be added to source code control, these values are private to the deployment organization, and must be dynamically injected. This is handled by using Kubernetes secrets during deployment, and trivial keys for developer desktops, all within a uniform process framework. That framework provides a command line interface (CLI) for creating system super users, data migration, starting the application, and packaging executables, among other tasks.</p>
</div>
</div>
<div class="section" id="management-cli">
<h2>Management CLI<a class="headerlink" href="#management-cli" title="Permalink to this headline">¶</a></h2>
<p>The appstore management CLI provides uniform commands for using the environment. It provides default values for secrets during local development and ways to provide secrets in production.</p>
<p>| Command                          | Description   |
| ———————————|—————|
| bin/appstore tests {product}     | Run automated unit tests with {product} settings. |
| bin/appstore run {product}       | Run the appstore using {product} settings.      |
| bin/appstore createsuperuser     | Create admin user with environment variable provided values.      |
| bin/appstore image build         | Build the docker image.      |
| bin/appstore image push          | Push the docker image to the repository.      |
| bin/appstore image run {product} | Run automated unit tests with {product} settings.      |
| bin/appstore help                | Run automated unit tests with {product} settings.      |</p>
</div>
<div class="section" id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h2>
<p>Automated testing uses the Python standard unittest and Django testing frameworks. Tests should be fast enough to run conveniently, and maximize coverage. For example, the Django testing framework allows for testing URL routes, middleware and other use interface elements in addition to the logic of components.</p>
</div>
<div class="section" id="packaging">
<h2>Packaging<a class="headerlink" href="#packaging" title="Permalink to this headline">¶</a></h2>
<p>Appstore is packaged as a Docker image. It is a non-root container, meaning the user is not a superuser. It packages a branch of Tycho cloned within the appstore hierarchy.</p>
<p>Launching an application via the AppStore uses the Tycho module which manages a metadata based representation of all available workspaces. Workspaces are defined as docker-compose YAML artifacts. These, in turn, specify sets of cooperating Docker containers constituting a distributed system. Tycho translates these app specifications into Kubernetes constructs to instantiate and run the application. During this process, Tycho also registers the app instance with the Ambassador programmable reverse proxy specifying that only the user that instantiated the application is authorized to access the instance. In addition to configuring the application’s networking and authorization interfaces, Tycho also configures the workspace’s access to persistent storage. HeLx requires a single Kubernetes construct known as a persistent volume (PV) to designate a storage location. It must be configured as Read-Write-Many to allow multiple Kubernetes deployments to access it simultaneously. Given that configuration, Tycho will configure a sub path on the PV for each user’s home directory and mount that path to each container it creates that is a component of an app.</p>
</div>
</div>
<div class="section" id="app-development">
<h1>App Development<a class="headerlink" href="#app-development" title="Permalink to this headline">¶</a></h1>
<p>During development, environment variables can be set to control execution:</p>
<p>| Variable            | Description   |
| ——————–|—————|
| DEV_PHASE=[stub, local, dev, val, prod     | In stub, does not require a Tycho service. |
| ALLOW_DJANGO_LOGIN=[TRUE, FALSE]     | When true, presents username and password authentication options.      |
| SECRET_KEY     | Key for securing the application.      |
| OAUTH_PROVIDERS     | Contains all the providers(google, github).     |
| GOOGLE_CLIENT_ID     | Contains the client_id of the provider.     |
| GOOGLE_SECRET     | Contains the secret key for provider.      |
| GOOGLE_NAME     | Sets the name for the provider.     |
| GOOGLE_KEY     | Holds the key value for provider. |
| GOOGLE_SITES     | Contains the sites for the provider.      |
| GITHUB_CLIENT_ID     | Contains the client_id of the provider.      |
| GITHUB_SECRET     | Contains the secret key of the provider.     |
| GITHUB_NAME     | Sets the name for the provider.     |
| GITHUB_KEY     | Holds the key value for provider.      |
| GITHUB_SITES     | Contains the sites for the provider.     |
| APPSTORE_DJANGO_USERNAME     | Holds superuser username credentials. |
| APPSTORE_DJANGO_PASSWORD     | Holds superuser password credentials.      |
| TYCHO_URL     | Contains the url of the running tycho host.      |
| OAUTH_DB_DIR     | Contains the path for the database directory.     |
| OAUTH_DB_FILE     | Contains the path for the database file.     |
| POSTGRES_DB     | Contains the connection of the database.      |
| POSTGRES_HOST     | Contains the database host.     |
| DATABASE_USER     | Contains the database username credentials.     |
| DATABASE_PASSWORD     | Contains the database password credentials.      |
| APPSTORE_DEFAULT_FROM_EMAIL     | Default email address for appstore.     |
| APPSTORE_DEFAULT_SUPPORT_EMAIL     | Default support email for appstore.      |
| ACCOUNT_DEFAULT_HTTP_PROTOCOL     | Allows to switch between http and https protocol.     |</p>
<div class="section" id="app-metadata">
<h2>App Metadata<a class="headerlink" href="#app-metadata" title="Permalink to this headline">¶</a></h2>
<p>Making application development easy is key to bringing the widest range of useful tools to the platform so we prefer metadata to code wherever possible for creating HeLx Apps. Apps are systems of cooperating processes. These are expressed using <a class="reference external" href="https://www.docker.com/">Docker</a> and <a class="reference external" href="https://docs.docker.com/compose/">Docker Compose</a>. Appstore uses the <a class="reference external" href="https://helxplatform.github.io/tycho-docs/gen/html/index.html">Tycho</a> engine to discover and manage Apps. The <a class="reference external" href="https://github.com/helxplatform/tycho/blob/metadata/tycho/conf/app-registry.yaml">Tycho app metadata</a> format specifies the details of each application, contexts to which applications belong, and inheritance relationships between contexts.</p>
<p>Docker compose syntax is used to express cooperating containers comprising an application. The specifications are stored in <a class="reference external" href="https://github.com/helxplatform/app-support-prototype/tree/develop/dockstore-yaml-proposals">GitHub</a>, each in an application specific subfolder. Along with the docker compose, a <code class="docutils literal notranslate"><span class="pre">.env</span></code> file specifies environment variables for the application. If a file called icon.png is provided, that is used as the application’s icon.</p>
</div>
<div class="section" id="development-environment">
<h2>Development Environment<a class="headerlink" href="#development-environment" title="Permalink to this headline">¶</a></h2>
<p>More information coming soon. The following script outlines the process:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash

set -ex

# start fresh
rm -rf appstore
#  get a vritualenv
if [ ! -d venv ]; then
    python3 -m venv venv
fi
source venv/bin/activate
# clone appstore
if [ ! -d appstore ]; then
    git clone git@github.com:helxplatform/appstore.git
fi
cd appstore
# use metadata branch and install requirements
git checkout metadata
cd appstore
pip install -r requirements.txt

# configure helx product =&gt; braini
product=braini
# configure dev mode to stub (run w/o tycho api)
export DEV_PHASE=stub
# create and or migrate the database
bin/appstore updatedb $product
# create the superuser (admin/admin by default)
bin/appstore createsuperuser
# execute automated tests
bin/appstore tests $product
# run the appstore at localhost:8000
bin/appstore run $product
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">HeLx</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Isma Gilani.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/authentication.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>