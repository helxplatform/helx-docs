
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>1. HeLx Framework Overview &#8212; HeLx 1.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="2. AppStore" href="appstore.html" />
    <link rel="prev" title="HeLx User Documentation" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="helx-framework-overview">
<h1><span class="section-number">1. </span>HeLx Framework Overview<a class="headerlink" href="#helx-framework-overview" title="Permalink to this headline">¶</a></h1>
<div class="section" id="tycho">
<h2><span class="section-number">1.1. </span>Tycho<a class="headerlink" href="#tycho" title="Permalink to this headline">¶</a></h2>
<p>Tycho is an API, compiler, and executor for cloud native distributed
systems.</p>
<ul class="simple">
<li><p>A subset of <a class="reference external" href="https://docs.docker.com/compose/">docker-compose</a> is
the system specification syntax.</p></li>
<li><p><a class="reference external" href="https://kubernetes.io">Kubernetes</a> is the first supported
orchestrator.</p></li>
<li><p>The Helm chart for deploying Tycho can be found
<a class="reference external" href="https://github.com/helxplatform/devops/tree/master/helx/charts/tycho-api">here</a>.</p></li>
</ul>
<div class="section" id="goals">
<h3><span class="section-number">1.1.1. </span>Goals<a class="headerlink" href="#goals" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><strong>Application Simplity</strong>: The Kubernetes API is reliable, extensive,
and well documented. It is also large, complex, supports a range of
possibilities greater than many applications need, and often requires
the creation and control of many objects to execute comparatively
simple scenarios. Tycho bridges the simplicity of Compose to the
richness of the Kubernetes’ architecture.</p></li>
<li><p><strong>icroservice</strong>: We wanted an end to end Python 12-factory style
OpenAPI microservice that fits seamlessly into a Python ecosystem
(which is why we did not use the excellent Kompose tool as a starting
point).</p></li>
<li><p><strong>Lifecycle Management</strong>: Tycho treats distributed systems as
programs whose entire lifecycle can be programmatically managed via
an API.</p></li>
<li><p><strong>Pluggable Orchestrators</strong>: The Tycho compiler abstracts clients
from the orchestrator. It creates an abstract syntax tree to model
input systems and generates orchestrator specific artifacts.</p></li>
<li><p><strong>Policy</strong>: Tycho now generates network policy configurations
governing the ingress and egress of traffic to systems. We anticipate
generalizing the policy layer to allow security and other concerns to
be woven into a deployment dynamically.</p></li>
</ul>
</div>
<div class="section" id="partnering-technologies">
<h3><span class="section-number">1.1.2. </span>Partnering Technologies<a class="headerlink" href="#partnering-technologies" title="Permalink to this headline">¶</a></h3>
<p>This work relies on these foundations:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=&amp;cad=rja&amp;uact=8&amp;ved=2ahUKEwjpusKw2YzsAhUBlHIEHXNbBicQFjAAegQIBBAB&amp;url=https%3A%2F%2Frenci.org%2Fwp-content%2Fuploads%2F2019%2F02%2FCloud_19.pdf&amp;usg=AOvVaw26F8j_JW86Vg3HZE6gHyaV">PIVOT</a>: A cloud agnostic scheduler with an API for executing distributed systems.</p></li>
<li><p><a class="reference external" href="https://kubernetes.io">Kubernetes</a>: Widely deployed, highly programmable, horizontally scalable container orchestration platform.</p></li>
<li><p><a class="reference external" href="https://docs.docker.com/compose/">Kompose</a>: Automates conversion of Docker Compose to Kubernetes. Written in Go, does not provide an API. Supports Docker Compose to Kubernetes only.</p></li>
<li><p><a class="reference external" href="https://www.docker.com/">Docker</a>: Pervasive Linux containerization tool chain enabling programmable infrastructure and portability.</p></li>
<li><p><a class="reference external" href="https://docs.docker.com/compose/">Docker-compose</a>: Syntax and tool chain for executing distributed systems of containers.</p></li>
<li><p>Docker Swarm: Docker only container orchestration platform with minimal adoption.</p></li>
</ul>
</div>
<div class="section" id="quick-start">
<h3><span class="section-number">1.1.3. </span>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h3>
<p>samples/jupyter-ds/docker-compose.yaml:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="c1"># Docker compose formatted system.</span>
<span class="n">version</span><span class="p">:</span> <span class="s2">&quot;3&quot;</span>
<span class="n">services</span><span class="p">:</span>
  <span class="n">jupyter</span><span class="o">-</span><span class="n">datascience</span><span class="p">:</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">jupyter</span><span class="o">/</span><span class="n">datascience</span><span class="o">-</span><span class="n">notebook</span>
    <span class="n">entrypoint</span><span class="p">:</span> <span class="n">start</span><span class="o">.</span><span class="n">sh</span> <span class="n">jupyter</span> <span class="n">lab</span> <span class="o">--</span><span class="n">LabApp</span><span class="o">.</span><span class="n">token</span><span class="o">=</span>
    <span class="n">ports</span><span class="p">:</span>
      <span class="o">-</span> <span class="mi">8888</span><span class="p">:</span><span class="mi">8888</span>
</pre></div>
</div>
<p>In one shell, run the API:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export PATH=~/dev/tycho/bin:$PATH
$ tycho api --debug
</pre></div>
</div>
<p>In another, launch three notebook instances.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export PATH=~/dev/tycho/bin:$PATH
$ tycho up -f sample/jupyter-ds/docker-compose.yaml
SYSTEM                         GUID                                PORT
jupyter-ds                     909f2e60b83340cd905ae3865d461156    32693
$ tycho up -f sample/jupyter-ds/docker-compose.yaml
SYSTEM                         GUID                                PORT
jupyter-ds                     6fc07ab865d14c4c8fd2d6e0380b270e    31333
$ tycho up -f sample/jupyter-ds/docker-compose.yaml
SYSTEM                         GUID                                PORT
jupyter-ds                     38f01c140f0141d9b4dc1baa33960362    32270
</pre></div>
</div>
<p>Then make a request to each instance to show it’s running. It may take a
moment for the instances to be ready, especially if you’re pulling a
container for the first time.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ for p in $(tycho status | grep -v PORT | awk &#39;{ print $4 }&#39;); do
   url=http://$(minikube ip):$p; echo $url; wget -q -O- $url | grep /title;
done
http://192.168.99.111:32270
  &lt;title&gt;JupyterLab&lt;/title&gt;
http://192.168.99.111:31333
  &lt;title&gt;JupyterLab&lt;/title&gt;
http://192.168.99.111:32693
  &lt;title&gt;JupyterLab&lt;/title&gt;
</pre></div>
</div>
<p>Delete all running deployments.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tycho down $(tycho status --terse)
38f01c140f0141d9b4dc1baa33960362
6fc07ab865d14c4c8fd2d6e0380b270e
909f2e60b83340cd905ae3865d461156
</pre></div>
</div>
<p>And show that they’re gone.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tycho status
None running
</pre></div>
</div>
</div>
<div class="section" id="architecture">
<h3><span class="section-number">1.1.4. </span>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h3>
<p>[[AUTHOR NOTE: THERE’S A PICTURE THAT GOES HERE!!!!]]</p>
</div>
<div class="section" id="install">
<h3><span class="section-number">1.1.5. </span>Install<a class="headerlink" href="#install" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Install python 3.7.x or greater.</p></li>
<li><p>Create a virtual environment.</p></li>
<li><p>Install the requirements.</p></li>
<li><p>Start the server.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python3 -m venv environmentName
source environmentName/bin/activate
pip install -r requirements.txt
export PATH=&lt;tycho-repo-dir&gt;/bin:$PATH
tycho api
</pre></div>
</div>
</div>
<div class="section" id="usage-a-development-environment-next-to-minikube">
<h3><span class="section-number">1.1.6. </span>Usage - A. Development Environment Next to Minikube<a class="headerlink" href="#usage-a-development-environment-next-to-minikube" title="Permalink to this headline">¶</a></h3>
<p>[[AUTHOR NOTE: THERE’S A PICTURE THAT GOES HERE!!!!]]</p>
<p>This mode uses a local minikube instance with Tycho running outside of
Minikube. This is the easiest way to add and test new features quickly.</p>
<p>Run minikube:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">minikbue</span> <span class="n">start</span>
</pre></div>
</div>
<p>Run the minikube dashboard:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">minikube</span> <span class="n">dashboard</span>
</pre></div>
</div>
<p>Run the Tycho API:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd tycho
PYTHONPATH=$PWD/.. python api.py
</pre></div>
</div>
<p>Launch the Swagger interface <code class="docutils literal notranslate"><span class="pre">http://localhost:5000/apidocs/</span></code></p>
<p>[[AUTHOR NOTE: THERE’S A PICTURE THAT GOES HERE!!!!]]</p>
<p>Use the Tycho CLI client as shown above or invoke the API.</p>
<div class="section" id="usage-b-development-environment-within-minikube">
<h4><span class="section-number">1.1.6.1. </span>Usage - B. Development Environment Within Minikube<a class="headerlink" href="#usage-b-development-environment-within-minikube" title="Permalink to this headline">¶</a></h4>
<p>When we deploy Tycho into Minikube it is now able to get its Kubernetes
API configuration from within the cluster.</p>
<p>In the repo’s kubernetes directory, we define deployment, pod, service,
clusterrole, and clusterrolebinding models for Tycho. The following
interaction shows deploying Tycho into Minikube and interacting with the
API.</p>
<p>We first deploy all Kubernetes Tycho-api artifacts into Minkube:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(tycho) [scox@mac~/dev/tycho/tycho]$ kubectl create -f ../kubernetes/
deployment.extensions/tycho-api created
pod/tycho-api created
clusterrole.rbac.authorization.k8s.io/tycho-api-access created
clusterrolebinding.rbac.authorization.k8s.io/tycho-api-access created
service/tycho-api created
</pre></div>
</div>
<p>Then we use the client as usual.</p>
</div>
<div class="section" id="usage-c-within-google-kubernetes-engine-from-the-google-cloud">
<h4><span class="section-number">1.1.6.2. </span>Usage - C. Within Google Kubernetes Engine from the Google Cloud<a class="headerlink" href="#usage-c-within-google-kubernetes-engine-from-the-google-cloud" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="shell">
<h4><span class="section-number">1.1.6.3. </span>Shell<a class="headerlink" href="#shell" title="Permalink to this headline">¶</a></h4>
<p>Starting out, Tycho’s not running on the cluster:</p>
<p>[[AUTHOR NOTE: THERE’S A PICTURE THAT GOES HERE!!!!]]</p>
<p>First deploy the Tycho API</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl create -f ../kubernetes/
deployment.extensions/tycho-api created
pod/tycho-api created
clusterrole.rbac.authorization.k8s.io/tycho-api-access created
clusterrolebinding.rbac.authorization.k8s.io/tycho-api-access created
service/tycho-api created
</pre></div>
</div>
<p><em>Here we’ve edited the Tycho service def to create the service as
type:LoadBalancer for the purposes of a command line demo. In general,
we’ll access the service from within the cluster rather than exposing it
externally.</em></p>
<p>That runs Tycho:</p>
<p>[[AUTHOR NOTE: THERE’S A PICTURE THAT GOES HERE!!!!]]</p>
<p>Initialize the Tycho API’s load balancer IP and node port.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lb_ip=$(kubectl get svc tycho-api -o json | jq .status.loadBalancer.ingress[0].ip | sed -e s,\&quot;,,g)
$ tycho_port=$(kubectl get service tycho-api --output json | jq .spec.ports[0].port)
</pre></div>
</div>
<p>Launch an application (deployment, pod, service). Note the <code class="docutils literal notranslate"><span class="pre">--command</span></code>
flag is used to specify the command to run in the container. We use this
to specify a flag that will cause the notebook to start without
prompting for authentication credentials.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ PYTHONPATH=$PWD/.. python client.py --up -n jupyter-data-science-3425 -c jupyter/datascience-notebook -p 8888 --command &quot;start.sh jupyter lab --LabApp.token=&#39;
&#39;&quot;
200
{
  &quot;status&quot;: &quot;success&quot;,
  &quot;result&quot;: {
    &quot;containers&quot;: {
      &quot;jupyter-data-science-3425-c&quot;: {
        &quot;port&quot;: 32414
      }
    }
  },
  &quot;message&quot;: &quot;Started system jupyter-data-science-3425&quot;
}
</pre></div>
</div>
<p>Refreshing the GKE cluster monitoring UI will now show the service
starting:</p>
<p>[[AUTHOR NOTE: THERE’S A PICTURE THAT GOES HERE!!!!]]</p>
<p>Then running:</p>
<p>[[AUTHOR NOTE: THERE’S A PICTURE THAT GOES HERE!!!!]]</p>
<p>Get the job’s load balancer ip and make a request to test the service.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ job_lb_ip=$(kubectl get svc jupyter-data-science-3425 -o json | jq .status.loadBalancer.ingress[0].ip | sed -e s,\&quot;,,g)
$ wget --quiet -O- http://$job_lb_ip:8888 | grep -i /title
    &lt;title&gt;Jupyter Notebook&lt;/title&gt;
</pre></div>
</div>
<p>From a browser, that URL takes us directly to the Jupyter Lab IDE:</p>
<p>[[AUTHOR NOTE: THERE’S A PICTURE THAT GOES HERE!!!!]]</p>
<p>And shut the service down:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ PYTHONPATH=$PWD/.. python client.py --down -n jupyter-data-science-3425 -s http://$lb_ip:$tycho_port
200
{
  &quot;status&quot;: &quot;success&quot;,
  &quot;result&quot;: null,
  &quot;message&quot;: &quot;Deleted system jupyter-data-science-3425&quot;
}
</pre></div>
</div>
<p>This removes the deployment, pod, service, and replicasets created by
the launcher.</p>
</div>
<div class="section" id="client-endpoint-autodiscovery">
<h4><span class="section-number">1.1.6.4. </span>Client Endpoint Autodiscovery<a class="headerlink" href="#client-endpoint-autodiscovery" title="Permalink to this headline">¶</a></h4>
<p>Using the command lines above without the <code class="docutils literal notranslate"><span class="pre">-s</span></code> flag for server will
work on GKE. That is, the client is created by first using the K8s API
to locate the Tycho-API endpoint and port. It builds the URL
automatically and creates a TychoAPI object ready to use.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">client_factory</span> <span class="o">=</span> <span class="n">TychoClientFactory</span> <span class="p">()</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">client_factory</span><span class="o">.</span><span class="n">get_client</span> <span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">HeLx</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. Tycho</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#tycho">1.1. Tycho</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#goals">1.1.1. Goals</a></li>
<li class="toctree-l3"><a class="reference internal" href="#partnering-technologies">1.1.2. Partnering Technologies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#quick-start">1.1.3. Quick Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="#architecture">1.1.4. Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install">1.1.5. Install</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage-a-development-environment-next-to-minikube">1.1.6. Usage - A. Development Environment Next to Minikube</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#usage-b-development-environment-within-minikube">1.1.6.1. Usage - B. Development Environment Within Minikube</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage-c-within-google-kubernetes-engine-from-the-google-cloud">1.1.6.2. Usage - C. Within Google Kubernetes Engine from the Google Cloud</a></li>
<li class="toctree-l4"><a class="reference internal" href="#shell">1.1.6.3. Shell</a></li>
<li class="toctree-l4"><a class="reference internal" href="#client-endpoint-autodiscovery">1.1.6.4. Client Endpoint Autodiscovery</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="appstore.html">2. AppStore</a></li>
<li class="toctree-l1"><a class="reference internal" href="install_devops.html">3. DevOps</a></li>
<li class="toctree-l1"><a class="reference internal" href="install_more.html">4. More Specific Installs</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">5. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html#installing-helx">6. Installing HeLx</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">7. Current and Upcoming Releases</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">HeLx User Documentation</a></li>
      <li>Next: <a href="appstore.html" title="next chapter"><span class="section-number">2. </span>AppStore</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Isma Gilani.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/tycho.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>