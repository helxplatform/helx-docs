

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>HeLx Framework Overview &mdash; HeLx 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="AppStore" href="appstore.html" />
    <link rel="prev" title="HeLx Documentation" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> HeLx
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tycho</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#tycho">Tycho</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#goals">Goals</a></li>
<li class="toctree-l3"><a class="reference internal" href="#partnering-technologies">Partnering Technologies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#quick-start">Quick Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="#architecture">Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install">Install</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage-a-development-environment-next-to-minikube">Usage - A. Development Environment Next to Minikube</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#usage-b-development-environment-within-minikube">Usage - B. Development Environment Within Minikube</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage-c-within-google-kubernetes-engine-from-the-google-cloud">Usage - C. Within Google Kubernetes Engine from the Google Cloud</a></li>
<li class="toctree-l4"><a class="reference internal" href="#shell">Shell</a></li>
<li class="toctree-l4"><a class="reference internal" href="#client-endpoint-autodiscovery">Client Endpoint Autodiscovery</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="appstore.html">AppStore</a></li>
<li class="toctree-l1"><a class="reference internal" href="appstore.html#development-environment-with-kubernetes">Development Environment with Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Current and Upcoming Releases</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">HeLx</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>HeLx Framework Overview</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/tycho.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="helx-framework-overview">
<h1>HeLx Framework Overview<a class="headerlink" href="#helx-framework-overview" title="Permalink to this headline">¶</a></h1>
<div class="section" id="tycho">
<h2>Tycho<a class="headerlink" href="#tycho" title="Permalink to this headline">¶</a></h2>
<p>Tycho is an API, compiler, and executor for cloud native distributed
systems.</p>
<ul class="simple">
<li><p>A subset of <a class="reference external" href="https://docs.docker.com/compose/">docker-compose</a> is
the system specification syntax.</p></li>
<li><p><a class="reference external" href="https://kubernetes.io">Kubernetes</a> is the first supported
orchestrator.</p></li>
<li><p>The Helm chart for deploying Tycho can be found
<a class="reference external" href="https://github.com/helxplatform/devops/tree/master/helx/charts/tycho-api">here</a>.</p></li>
</ul>
<div class="section" id="goals">
<h3>Goals<a class="headerlink" href="#goals" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><strong>Application Simplity</strong>: The Kubernetes API is reliable, extensive,
and well documented. It is also large, complex, supports a range of
possibilities greater than many applications need, and often requires
the creation and control of many objects to execute comparatively
simple scenarios. Tycho bridges the simplicity of Compose to the
richness of the Kubernetes’ architecture.</p></li>
<li><p><strong>Microservice</strong>: We wanted an end to end Python 12-factory style
OpenAPI microservice that fits seamlessly into a Python ecosystem
(which is why we did not use the excellent Kompose tool as a starting
point).</p></li>
<li><p><strong>Lifecycle Management</strong>: Tycho treats distributed systems as
programs whose entire lifecycle can be programmatically managed via
an API.</p></li>
<li><p><strong>Pluggable Orchestrators</strong>: The Tycho compiler abstracts clients
from the orchestrator. It creates an abstract syntax tree to model
input systems and generates orchestrator specific artifacts.</p></li>
<li><p><strong>Policy</strong>: Tycho now generates network policy configurations
governing the ingress and egress of traffic to systems. We anticipate
generalizing the policy layer to allow security and other concerns to
be woven into a deployment dynamically.</p></li>
</ul>
</div>
<div class="section" id="partnering-technologies">
<h3>Partnering Technologies<a class="headerlink" href="#partnering-technologies" title="Permalink to this headline">¶</a></h3>
<p>This work relies on these foundations:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=&amp;cad=rja&amp;uact=8&amp;ved=2ahUKEwjpusKw2YzsAhUBlHIEHXNbBicQFjAAegQIBBAB&amp;url=https%3A%2F%2Frenci.org%2Fwp-content%2Fuploads%2F2019%2F02%2FCloud_19.pdf&amp;usg=AOvVaw26F8j_JW86Vg3HZE6gHyaV">PIVOT</a>: A cloud agnostic scheduler with an API for executing distributed systems.</p></li>
<li><p><a class="reference external" href="https://kubernetes.io">Kubernetes</a>: Widely deployed, highly programmable, horizontally scalable container orchestration platform.</p></li>
<li><p><a class="reference external" href="https://docs.docker.com/compose/">Kompose</a>: Automates conversion of Docker Compose to Kubernetes. Written in Go, does not provide an API. Supports Docker Compose to Kubernetes only.</p></li>
<li><p><a class="reference external" href="https://www.docker.com/">Docker</a>: Pervasive Linux containerization tool chain enabling programmable infrastructure and portability.</p></li>
<li><p><a class="reference external" href="https://docs.docker.com/compose/">Docker-compose</a>: Syntax and tool chain for executing distributed systems of containers.</p></li>
<li><p>Docker Swarm: Docker only container orchestration platform with minimal adoption.</p></li>
</ul>
</div>
<div class="section" id="quick-start">
<h3>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h3>
<p>samples/jupyter-ds/docker-compose.yaml:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="c1"># Docker compose formatted system.</span>
<span class="n">version</span><span class="p">:</span> <span class="s2">&quot;3&quot;</span>
<span class="n">services</span><span class="p">:</span>
  <span class="n">jupyter</span><span class="o">-</span><span class="n">datascience</span><span class="p">:</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">jupyter</span><span class="o">/</span><span class="n">datascience</span><span class="o">-</span><span class="n">notebook</span>
    <span class="n">entrypoint</span><span class="p">:</span> <span class="n">start</span><span class="o">.</span><span class="n">sh</span> <span class="n">jupyter</span> <span class="n">lab</span> <span class="o">--</span><span class="n">LabApp</span><span class="o">.</span><span class="n">token</span><span class="o">=</span>
    <span class="n">ports</span><span class="p">:</span>
      <span class="o">-</span> <span class="mi">8888</span><span class="p">:</span><span class="mi">8888</span>
</pre></div>
</div>
<p>In one shell, run the API:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export PATH=~/dev/tycho/bin:$PATH
$ tycho api --debug
</pre></div>
</div>
<p>In another, launch three notebook instances.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export PATH=~/dev/tycho/bin:$PATH
$ tycho up -f sample/jupyter-ds/docker-compose.yaml
SYSTEM                         GUID                                PORT
jupyter-ds                     909f2e60b83340cd905ae3865d461156    32693
$ tycho up -f sample/jupyter-ds/docker-compose.yaml
SYSTEM                         GUID                                PORT
jupyter-ds                     6fc07ab865d14c4c8fd2d6e0380b270e    31333
$ tycho up -f sample/jupyter-ds/docker-compose.yaml
SYSTEM                         GUID                                PORT
jupyter-ds                     38f01c140f0141d9b4dc1baa33960362    32270
</pre></div>
</div>
<p>Then make a request to each instance to show it’s running. It may take a
moment for the instances to be ready, especially if you’re pulling a
container for the first time.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ for p in $(tycho status | grep -v PORT | awk &#39;{ print $4 }&#39;); do
   url=http://$(minikube ip):$p; echo $url; wget -q -O- $url | grep /title;
done
http://192.168.99.111:32270
  &lt;title&gt;JupyterLab&lt;/title&gt;
http://192.168.99.111:31333
  &lt;title&gt;JupyterLab&lt;/title&gt;
http://192.168.99.111:32693
  &lt;title&gt;JupyterLab&lt;/title&gt;
</pre></div>
</div>
<p>Delete all running deployments.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tycho down $(tycho status --terse)
38f01c140f0141d9b4dc1baa33960362
6fc07ab865d14c4c8fd2d6e0380b270e
909f2e60b83340cd905ae3865d461156
</pre></div>
</div>
<p>And show that they’re gone.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tycho status
None running
</pre></div>
</div>
</div>
<div class="section" id="architecture">
<h3>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h3>
<img alt="tycho architecture diagram" class="align-center" src="_images/tycho-1.png" />
</div>
<div class="section" id="install">
<h3>Install<a class="headerlink" href="#install" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Install python 3.7.x or greater.</p></li>
<li><p>Create a virtual environment.</p></li>
<li><p>Install the requirements.</p></li>
<li><p>Start the server.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python3 -m venv environmentName
source environmentName/bin/activate
pip install -r requirements.txt
export PATH=&lt;tycho-repo-dir&gt;/bin:$PATH
tycho api
</pre></div>
</div>
</div>
<div class="section" id="usage-a-development-environment-next-to-minikube">
<h3>Usage - A. Development Environment Next to Minikube<a class="headerlink" href="#usage-a-development-environment-next-to-minikube" title="Permalink to this headline">¶</a></h3>
<p>This mode uses a local minikube instance with Tycho running outside of
Minikube. This is the easiest way to add and test new features quickly.</p>
<p>Run minikube:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">minikbue</span> <span class="n">start</span>
</pre></div>
</div>
<p>Run the minikube dashboard:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">minikube</span> <span class="n">dashboard</span>
</pre></div>
</div>
<p>Run the Tycho API:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd tycho
PYTHONPATH=$PWD/.. python api.py
</pre></div>
</div>
<p>Launch the Swagger interface <code class="docutils literal notranslate"><span class="pre">http://localhost:5000/apidocs/</span></code></p>
<img alt="tycho architecture diagram" class="align-center" src="_images/tycho-2.png" />
<p>Use the Tycho CLI client as shown above or invoke the API.</p>
<div class="section" id="usage-b-development-environment-within-minikube">
<h4>Usage - B. Development Environment Within Minikube<a class="headerlink" href="#usage-b-development-environment-within-minikube" title="Permalink to this headline">¶</a></h4>
<p>When we deploy Tycho into Minikube it is now able to get its Kubernetes
API configuration from within the cluster.</p>
<p>In the repo’s kubernetes directory, we define deployment, pod, service,
clusterrole, and clusterrolebinding models for Tycho. The following
interaction shows deploying Tycho into Minikube and interacting with the
API.</p>
<p>We first deploy all Kubernetes Tycho-api artifacts into Minkube:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(tycho) [scox@mac~/dev/tycho/tycho]$ kubectl create -f ../kubernetes/
deployment.extensions/tycho-api created
pod/tycho-api created
clusterrole.rbac.authorization.k8s.io/tycho-api-access created
clusterrolebinding.rbac.authorization.k8s.io/tycho-api-access created
service/tycho-api created
</pre></div>
</div>
<p>Then we use the client as usual.</p>
</div>
<div class="section" id="usage-c-within-google-kubernetes-engine-from-the-google-cloud">
<h4>Usage - C. Within Google Kubernetes Engine from the Google Cloud<a class="headerlink" href="#usage-c-within-google-kubernetes-engine-from-the-google-cloud" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="shell">
<h4>Shell<a class="headerlink" href="#shell" title="Permalink to this headline">¶</a></h4>
<p>Starting out, Tycho’s not running on the cluster:</p>
<img alt="tycho architecture diagram" class="align-center" src="_images/tycho-3.png" />
<p>First deploy the Tycho API</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl create -f ../kubernetes/
deployment.extensions/tycho-api created
pod/tycho-api created
clusterrole.rbac.authorization.k8s.io/tycho-api-access created
clusterrolebinding.rbac.authorization.k8s.io/tycho-api-access created
service/tycho-api created
</pre></div>
</div>
<p><em>Here we’ve edited the Tycho service def to create the service as
type:LoadBalancer for the purposes of a command line demo. In general,
we’ll access the service from within the cluster rather than exposing it
externally.</em></p>
<p>That runs Tycho:</p>
<img alt="tycho architecture diagram" class="align-center" src="_images/tycho-4.png" />
<p>Initialize the Tycho API’s load balancer IP and node port.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lb_ip=$(kubectl get svc tycho-api -o json | jq .status.loadBalancer.ingress[0].ip | sed -e s,\&quot;,,g)
$ tycho_port=$(kubectl get service tycho-api --output json | jq .spec.ports[0].port)
</pre></div>
</div>
<p>Launch an application (deployment, pod, service). Note the <code class="docutils literal notranslate"><span class="pre">--command</span></code>
flag is used to specify the command to run in the container. We use this
to specify a flag that will cause the notebook to start without
prompting for authentication credentials.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ PYTHONPATH=$PWD/.. python client.py --up -n jupyter-data-science-3425 -c jupyter/datascience-notebook -p 8888 --command &quot;start.sh jupyter lab --LabApp.token=&#39;
&#39;&quot;
200
{
  &quot;status&quot;: &quot;success&quot;,
  &quot;result&quot;: {
    &quot;containers&quot;: {
      &quot;jupyter-data-science-3425-c&quot;: {
        &quot;port&quot;: 32414
      }
    }
  },
  &quot;message&quot;: &quot;Started system jupyter-data-science-3425&quot;
}
</pre></div>
</div>
<p>Refreshing the GKE cluster monitoring UI will now show the service
starting:</p>
<img alt="tycho architecture diagram" class="align-center" src="_images/tycho-5.png" />
<p>Then running:</p>
<img alt="tycho architecture diagram" class="align-center" src="_images/tycho-6.png" />
<p>Get the job’s load balancer ip and make a request to test the service.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ job_lb_ip=$(kubectl get svc jupyter-data-science-3425 -o json | jq .status.loadBalancer.ingress[0].ip | sed -e s,\&quot;,,g)
$ wget --quiet -O- http://$job_lb_ip:8888 | grep -i /title
    &lt;title&gt;Jupyter Notebook&lt;/title&gt;
</pre></div>
</div>
<p>From a browser, that URL takes us directly to the Jupyter Lab IDE:</p>
<img alt="tycho architecture diagram" class="align-center" src="_images/tycho-7.png" />
<p>And shut the service down:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ PYTHONPATH=$PWD/.. python client.py --down -n jupyter-data-science-3425 -s http://$lb_ip:$tycho_port
200
{
  &quot;status&quot;: &quot;success&quot;,
  &quot;result&quot;: null,
  &quot;message&quot;: &quot;Deleted system jupyter-data-science-3425&quot;
}
</pre></div>
</div>
<p>This removes the deployment, pod, service, and replicasets created by
the launcher.</p>
</div>
<div class="section" id="client-endpoint-autodiscovery">
<h4>Client Endpoint Autodiscovery<a class="headerlink" href="#client-endpoint-autodiscovery" title="Permalink to this headline">¶</a></h4>
<p>Using the command lines above without the <code class="docutils literal notranslate"><span class="pre">-s</span></code> flag for server will
work on GKE. That is, the client is created by first using the K8s API
to locate the Tycho-API endpoint and port. It builds the URL
automatically and creates a TychoAPI object ready to use.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">client_factory</span> <span class="o">=</span> <span class="n">TychoClientFactory</span> <span class="p">()</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">client_factory</span><span class="o">.</span><span class="n">get_client</span> <span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="appstore.html" class="btn btn-neutral float-right" title="AppStore" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="HeLx Documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Isma Gilani

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>