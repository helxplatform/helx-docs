

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>More Specific Installs &mdash; HeLx 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="7. Sample Text" href="releases.html" />
    <link rel="prev" title="DevOps" href="install_devops.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> HeLx
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="tycho.html">1. Tycho</a></li>
<li class="toctree-l1"><a class="reference internal" href="appstore.html">2. AppStore</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="installation.html">Installation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="installation.html#installing-helx">Installing HeLx</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="installation.html#install-helm3">Install helm3</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="installation.html#install-all-charts-using-a-single-command">Install all charts using a single command</a></li>
<li class="toctree-l4"><a class="reference internal" href="installation.html#install-charts-individually">Install charts individually</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="installation.html#installation-notes">Installation Notes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="installation.html#indices-and-tables">Indices and tables</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">7. Current and Upcoming Releases</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">HeLx</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="installation.html">Installation</a> &raquo;</li>
        
      <li>More Specific Installs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/install_more.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="more-specific-installs">
<h1>More Specific Installs<a class="headerlink" href="#more-specific-installs" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setup-a-kubernetes-cluster">
<h2>Setup a Kubernetes Cluster<a class="headerlink" href="#setup-a-kubernetes-cluster" title="Permalink to this headline">¶</a></h2>
<p><strong>Step-1:</strong> Before setting up a Kubernetes cluster we need to enable the
Kubernetes Engine API.</p>
<p><strong>Step-2:</strong> You can either using web based terminal provided by
google(Google Cloud shell) or run the required command line interfaces
on your own computers terminal.</p>
<p><strong>Step-3:</strong> Ask Google cloud to create a “Kubernetes cluster” and a
“default” node pool to get nodes from. Nodes represent the hardware and
node pools will keep track how much of a certain type of hardware is
required.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gcloud</span> <span class="n">container</span> <span class="n">clusters</span> <span class="n">create</span> \
  <span class="o">--</span><span class="n">machine</span><span class="o">-</span><span class="nb">type</span> <span class="n">n1</span><span class="o">-</span><span class="n">standard</span><span class="o">-</span><span class="mi">2</span> \
  <span class="o">--</span><span class="n">image</span><span class="o">-</span><span class="nb">type</span> <span class="n">ubuntu</span> \
  <span class="o">--</span><span class="n">num</span><span class="o">-</span><span class="n">nodes</span> <span class="mi">2</span> \
  <span class="o">--</span><span class="n">zone</span> <span class="n">us</span><span class="o">-</span><span class="n">east4</span><span class="o">-</span><span class="n">b</span> \
  <span class="o">--</span><span class="n">cluster</span><span class="o">-</span><span class="n">version</span> <span class="n">latest</span> \
</pre></div>
</div>
<p>To check if the cluster is initialized,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">get</span> <span class="n">node</span> <span class="o">-</span><span class="n">o</span> <span class="n">wide</span>
</pre></div>
</div>
<p><strong>Step-4</strong>: Give your account permissions to grant access to all the
cluster-scoped resources(like nodes) and namespaced resources (like
pods). RBAC (Role-based access control) should be used to regulate access
to resources to a specific user based on the role.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">create</span> <span class="n">clusterrolebinding</span> <span class="n">cluster</span><span class="o">-</span><span class="n">admin</span><span class="o">-</span><span class="n">binding</span> \
  <span class="o">--</span><span class="n">clusterrole</span><span class="o">=</span><span class="n">cluster</span><span class="o">-</span><span class="n">admin</span> \
  <span class="o">--</span><span class="n">user</span><span class="o">=</span>
</pre></div>
</div>
<p>Create a “cluster-admin” role and a cluster role biding to bind the role
to the user.</p>
<p>This project has four directories each one of each for Rstudio,
Elasticsearch, Kibana and Logstash. Hence this project is 4-tier.</p>
</div>
<div class="section" id="setup-elasticsearch">
<h2>Setup Elasticsearch<a class="headerlink" href="#setup-elasticsearch" title="Permalink to this headline">¶</a></h2>
<div class="section" id="installing-elasticsearch">
<h3>Installing Elasticsearch<a class="headerlink" href="#installing-elasticsearch" title="Permalink to this headline">¶</a></h3>
<p><strong>Step-1</strong>: Clone the repo and run the following command to deploy the
Elasticsearch using the following command,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">R</span> <span class="o">-</span><span class="n">f</span> <span class="n">elaticsearch</span><span class="o">/</span>
</pre></div>
</div>
<p>Elasticsearch uses Staefulsets, Replicas, Storage classes, Persistent
Volume Claims. A Headless Service acts as communication bridge to the
pod. The Statefulsets deploy elasticsearch nodes as an ordered index
(eg: elasticsearch-0, elasticsearch-1 etc) and each node gets a
persistent volume(data- ealsticsearch-0) which are launched dynamically
using Storage classes. A Persistent Volume Claim is used to bind the
Storage class definition to the elasticsearch Statefulset. One of the
node will be elected as Master. Since a Headless Service is used, the
clusterIP should be None. Each pod or node of elasticsearch will be
assigned a DNS name (eg:
elasticsearch-0.es-nodes.default.svc.cluster.local etc).</p>
<p>Wait till all the pods are successfully launched.</p>
</div>
</div>
<div class="section" id="setup-kibana">
<h2>Setup Kibana<a class="headerlink" href="#setup-kibana" title="Permalink to this headline">¶</a></h2>
<div class="section" id="installing-kibana">
<h3>Installing Kibana<a class="headerlink" href="#installing-kibana" title="Permalink to this headline">¶</a></h3>
<p><strong>Step-1</strong>: Run the following command to deploy the
Kibana app. This is UI for the user to analyse the logs.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">R</span> <span class="o">-</span><span class="n">f</span> <span class="n">kibana</span><span class="o">/</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="setup-logstash">
<h2>Setup Logstash<a class="headerlink" href="#setup-logstash" title="Permalink to this headline">¶</a></h2>
<div class="section" id="installing-logstash">
<h3>Installing Logstash<a class="headerlink" href="#installing-logstash" title="Permalink to this headline">¶</a></h3>
<p><strong>Step-1</strong>: Run the following commmand to deploy the
Logstash.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">R</span> <span class="o">-</span><span class="n">f</span> <span class="n">logstash</span><span class="o">/</span>
</pre></div>
</div>
<p>The configuration for the Logstash is defined in a
<code class="docutils literal notranslate"><span class="pre">ConfigMap(logstash-configmap.yaml)</span></code>.</p>
</div>
</div>
<div class="section" id="setup-nfs-server">
<h2>Setup NFS server<a class="headerlink" href="#setup-nfs-server" title="Permalink to this headline">¶</a></h2>
<div class="section" id="installing-nfs-server">
<h3>Installing NFS server<a class="headerlink" href="#installing-nfs-server" title="Permalink to this headline">¶</a></h3>
<p><strong>Step-1</strong>: The NFS server is backed by a google
persistent disk. Make sure it exists prior to the deployment. If the
persistent dosk does not exist, use the following command to create a
disk on a google kubernetes cluster,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gcloud</span> <span class="n">compute</span> <span class="n">disks</span> <span class="n">create</span> <span class="n">gce</span><span class="o">-</span><span class="n">nfs</span><span class="o">-</span><span class="n">disk</span> <span class="o">--</span><span class="n">size</span> <span class="mi">10</span><span class="n">GB</span> <span class="o">--</span><span class="n">zone</span> <span class="n">us</span><span class="o">-</span><span class="n">central1</span><span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
<p><strong>Step-2</strong>: Run the following command to deploy NFS server.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">R</span> <span class="o">-</span><span class="n">f</span> <span class="n">nfs</span><span class="o">-</span><span class="n">server</span>
</pre></div>
</div>
</div>
<div class="section" id="tbd">
<h3>TBD<a class="headerlink" href="#tbd" title="Permalink to this headline">¶</a></h3>
<p>This resource deploys a Rstudio on the cloud and leveraging cloud
scalable nature(using Google Kubernetes Engine) to support multiple
users. To capture audit logs for ecah command executed on the Rstudio
terminal we use auditd. A filebeat agent is used to ship logs to the ELK
stack deployed on the same cluster using Storage Classes, Headless
Services and Stateful Sets. Future work will provide walk-throughs for
building resources on the cluster through the Google Cloud Shell
(command line) as well as the Google Cloud Platform (GCP) console.</p>
</div>
</div>
<div class="section" id="setup-rstudio">
<h2>Setup Rstudio<a class="headerlink" href="#setup-rstudio" title="Permalink to this headline">¶</a></h2>
<div class="section" id="installing-rstudio">
<h3>Installing Rstudio<a class="headerlink" href="#installing-rstudio" title="Permalink to this headline">¶</a></h3>
<p><strong>Step-1</strong>: Run the following command to deploy the
Rstudio app.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">R</span> <span class="o">-</span><span class="n">f</span> <span class="n">rstudio</span><span class="o">/</span>
</pre></div>
</div>
<p>Rstudio uses API objects like Deployment, Persistent Volume Claim,
Persistent Volume, Service, ConfigMaps. Step-2: The persistent volume is
manually created before this deployment using the command below,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gcloud</span> <span class="n">compute</span> <span class="n">disks</span> <span class="n">create</span> <span class="n">rstudio</span><span class="o">-</span><span class="n">disk</span><span class="o">-</span><span class="mi">1</span> <span class="o">--</span><span class="n">zone</span> <span class="n">us</span><span class="o">-</span><span class="n">east4</span><span class="o">-</span><span class="n">b</span> <span class="o">--</span><span class="n">size</span> <span class="mi">10</span><span class="n">GB</span> <span class="o">--</span><span class="nb">type</span> <span class="n">pd</span><span class="o">-</span><span class="n">ssd</span>
</pre></div>
</div>
<p>The name of the persistent disk shown above is rstudio-disk-1. It can be
changed as per your requirement, but make sure to change this value in
the PVC defined for Rstudio server. The image used for the container is
“muralikarthikk/rstudio-serv:v8” which is custom build to include
pacakges like auditd and filebeat. The ConfigMap is used to add more
users on the Rstudio server. The format for defining the users is
“username “, seperated by tabs. Whenever a new user is added to the
server. Change the PVC name to pvc-for-rstudio- and re-deploy the
application using the command shown in the beginning. The python script
inside the container will add users as per the uid and gid mentioned and
creates a home directory on the Rstudio server. The Persistent Volume is
used to persist the data stored by users. The PV still persists even
when the Deployment, Service and ConfigMaps are deleted.</p>
<p>Whenever any configuration is made to the Rstudio deployment, we can use
the same PVC and PV to re-deploy the application.</p>
<p><em>When a PVC is deleted, the claim for the PV is lost and the data on it
is erased to make it available for re-claim. The Persistent Volume Claim
is used to bind the Rstudio app to the persistent disk created before.</em></p>
</div>
<div class="section" id="rstudio-deployment">
<h3>Rstudio Deployment.<a class="headerlink" href="#rstudio-deployment" title="Permalink to this headline">¶</a></h3>
<p>1. Configure the filebeat to resolve the DNS for
logstash instead of manually adding the logstash IP Address which is
exposed using a LoadBlancer type Service.</p>
<p>2. Securing Communication
between filebeat and Logstash using SSL.</p>
<ol class="arabic simple" start="3">
<li><p>Cluster specific settings.</p></li>
</ol>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="releases.html" class="btn btn-neutral float-right" title="7. Sample Text" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="install_devops.html" class="btn btn-neutral float-left" title="DevOps" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Isma Gilani

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>